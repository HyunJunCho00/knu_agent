name: Daily Notice Crawler

on:
  schedule:
    # í•œêµ­ ì‹œê°„ 00:00 = UTC 15:00
    - cron: '0 15 * * *'
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼ (í…ŒìŠ¤íŠ¸ìš©)

permissions:
  contents: write

jobs:
  crawl:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

      - name: Run Crawler
        env:
          # íŒŒì´ì¬ì´ app ëª¨ë“ˆì„ ì°¾ì„ ìˆ˜ ìˆê²Œ ê²½ë¡œ ì„¤ì •
          PYTHONPATH: ${{ github.workspace }}
        run: |
          echo "ğŸ•·ï¸ Starting Crawler..."
          # í¬ë¡¤ëŸ¬ ì‹¤í–‰ (ì„¤ì • íŒŒì¼ ë•ë¶„ì— data/ í´ë”ì— ìë™ ì €ì¥ë¨)
          python app/crawling/crawl_notice.py

      - name: Commit and Push changes
        run: |
          git config --global user.name 'KNU Bot'
          git config --global user.email 'actions@github.com'
          
          echo "ğŸ“‚ [Debug] Checking data directory content..."
          ls -R data/
          
          # [í•µì‹¬ ìˆ˜ì •] íŒŒì¼ì´ ì—†ì–´ë„ ì—ëŸ¬ê°€ ë‚˜ì§€ ì•Šë„ë¡ '|| true'ë¥¼ ë¶™ì…ë‹ˆë‹¤.
          # (ì´ê²Œ ì—†ìœ¼ë©´ ê³µì§€ê°€ ì—†ëŠ” ë‚  ì›Œí¬í”Œë¡œìš°ê°€ ë¹¨ê°„ë¶ˆë¡œ ì‹¤íŒ¨í•©ë‹ˆë‹¤)
          git add -f data/*.jsonl || true
          git add -f data/*.json || true
          
          # ì‹¤ì œë¡œ ì»¤ë°‹í•  ê²Œ ìˆëŠ”ì§€(ì¥ë°”êµ¬ë‹ˆê°€ ì°¼ëŠ”ì§€) í™•ì¸
          if git diff --staged --quiet; then
            echo "ğŸ›‘ No changes to commit. (ìƒˆë¡œìš´ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤)"
          else
            git commit -m "ğŸ“… Daily Update: $(date +'%Y-%m-%d')"
            git push
            echo "âœ… Data updated and pushed successfully!"
          fi